<script src="https://d3js.org/d3.v6.min.js"></script>

<style></style>
<link rel="stylesheet" href="style.css">

<body>
  <h1 id="Title">MQP Title Here</h1>
  <h4 id="Welcome Line">Welcome to the Mycobacterium Tuberculosis Metabolic Pathway Tool</h4>
  <p></p>
</body>

<!--A bunch of svg declarations that will be necessary in the following final viz
    svg1 - the metabolic pathway
    svg2 - the information on up and down regulation
    svg3 - PPI constructing network


    FIX SIZES AS NEEDED
-->
<svg id="Pathway" width="4000" height="2000"></svg>
<svg id="Regulation" width="1400" height="1000"></svg>
<svg id="PPI" width="1600" height="1000"></svg>

<!--Need to input some sort of button here to allow for the input of data that is tied to svg2-->

<script>
  /*Some code that takes in the data for the metabolic network, regulation, and PPI info*/
  //

  createVis()

  function createVis()
  {
    makePathway()
    makeRegulationList()
    makePPI()
  }

  /*Some code that draws the entire metabolic pathways (svg1)*/
  //SAMPLE SPACE
  function makePathway()
  {
    d3.select("#Pathway")
      .append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", 4000)
        .attr("height", 2000)
        .attr("stroke", "black")
        .attr("fill", "black")

    //For easy sorting, make all TF end with a captial T or something that will sort out or something to make invisible
    var nodes = [{name: "A"}, 
                 {name: "B"}, 
                 {name: "C"},
                 {name: "D"},
                 {name: "E"},
                 {name: "F"},
                 {name: "G"},
                 {name: "H"},
                 {name: "TF1"}, //8
                 {name: "TF2"}, //9
                 {name: "TF3"}] //10
    
    var links = [{source: 0, target: 1},
                 {source: 1, target: 2},
                 {source: 1, target: 5},
                 {source: 2, target: 4},
                 {source: 2, target: 7},
                 {source: 3, target: 4},
                 {source: 3, target: 5},
                 {source: 4, target: 6},
                 {source: 8, target: 4},
                 {source: 9, target: 5},
                 {source: 10, target: 6}]

    //Construct sample pathway
    /*
      -For normal proteins in the pathway, mark with a line
      -For proteins that serve to repress others, mark with a blockhead and line
      -For proteins that serve to activate others, mark with an arrowhead and a line
    */

    var simulation = d3.forceSimulation(nodes)
                       .force("charge", d3.forceManyBody().strength(-50))       //Strength of the attraction/repel
                       .force("center", d3.forceCenter(width / 2, height / 2))     //Determines center of the system
                       .force("link", d3.forceLink().links(links))
                       //.force("collision", d3.forceCollide().radius(function(d){return d.radius}))    //Prevents overlap of objects
                       .on("tick", ticked)    //Draws the objects

    function ticked()
    {
      updateLinksA()
      updateNodesA()

    }

    function updateNodesA()
    {
      u = d3.select("#Pathway")
                //.select(".nodes")
                .selectAll("text")
                .data(nodes)
                .join("text")
                .text(function(d) {return d.name})
                .attr("x", function(d){return d.x})
                .attr("y", function(d){return d.y})
                .attr("dy", function(d){return 5})
                .style("font-size", "30px")
                .attr("id", function(d){return d.name})
                .attr("stroke", "white")
                /*.attr("r", function(d) {return d.radius})
                .attr("cx", function(d) {return d.x})
                .attr("cy", function(d) {console.log(d); return d.y})
                .attr("fill", "green")
                .attr("stroke", "black")*/

      //Make all nodes that are transcription factors invisible
      
    }

    function updateLinksA()
    {
      var u = d3.select("#Pathway")
                //.select(".links")
                .selectAll("line")
                .data(links)
                .join("line")
                .attr("x1", function(d){return d.source.x})
                .attr("y1", function(d){return d.source.y})
                .attr("x2", function(d){return d.target.x})
                .attr("y2", function(d){return d.target.y})
                .attr("stroke", "white")
    }
  }

  /*Some code that notes changes in regulation in response to input data (svg2)*/
  //SAMPLE SPACE
  function makeRegulationList()
  {
    d3.select("#Regulation")
      .append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", 1400)
        .attr("height", 1000)
        .attr("stroke", "blue")
        .attr("fill", "blue")

    
  }

  /*Some code that creates a PPI for a selected protein in the network (svg3)*/
  //SAMPLE SPACE
  //Would be called on click to make the PPI
  //Goal: Make it a sticky graph feature
  /*
      -Node is clicked in the overall metabolic pathway
      -The node is identified, and that node is found in a dictionary containing the node in question and its interacting proteins
      -
  */
  function makePPI()
  {
    d3.select("#PPI")
      .append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", 1600)
        .attr("height", 1000)
        .attr("stroke", "red")
        .attr("fill", "red")

    
    var width = Number(d3.select("#PPI").style("width").replace(/px$/, ''))
    var height = Number(d3.select("#PPI").style("height").replace(/px$/, ''))
    
    var nodes = [{name: "A"}, 
                 {name: "B"}, 
                 {name: "C"},
                 {name: "D"},
                 {name: "E"},
                 {name: "F"},
                 {name: "G"},
                 {name: "H"}] //d3.range(100).map(function(d){return {radius: (25 * Math.random())}})

    var links = [{source: 4, target: 3},
                 {source: 4, target: 6}]

    var simulation = d3.forceSimulation(nodes)
                       .force("charge", d3.forceManyBody().strength(-50))       //Strength of the attraction/repel
                       .force("center", d3.forceCenter(width / 2, height / 2))     //Determines center of the system
                       .force("link", d3.forceLink().links(links))
                       //.force("collision", d3.forceCollide().radius(function(d){return d.radius}))    //Prevents overlap of objects
                       .on("tick", ticked)    //Draws the objects
                       
    function ticked() 
    {
      /*var u = d3.select("#PPI")
              .selectAll("circle")
              .data(nodes)
              .join("circle")
              .attr("r", function(d) {return d.radius})
              .attr("cx", function(d) {return d.x})
              .attr("cy", function(d) {console.log(d); return d.y})
              .attr("fill", "green")
              .attr("stroke", "black")*/

      updateLinks()
      updateNodes()
    }

    function updateNodes()
    {
      u = d3.select("#PPI")
                //.select(".nodes")
                .selectAll("text")
                .data(nodes)
                .join("text")
                .text(function(d) {return d.name})
                .attr("x", function(d){return d.x})
                .attr("y", function(d){return d.y})
                .attr("dy", function(d){return 5})
                .style("font-size", "30px")
                /*.attr("r", function(d) {return d.radius})
                .attr("cx", function(d) {return d.x})
                .attr("cy", function(d) {console.log(d); return d.y})
                .attr("fill", "green")
                .attr("stroke", "black")*/
    }

    function updateLinks()
    {
      var u = d3.select("#PPI")
                //.select(".links")
                .selectAll("line")
                .data(links)
                .join("line")
                .attr("x1", function(d){return d.source.x})
                .attr("y1", function(d){return d.source.y})
                .attr("x2", function(d){return d.target.x})
                .attr("y2", function(d){return d.target.y})
                .attr("stroke", "black")
    }
  }



  
</script>
